#!/usr/bin/python
# -*- coding: utf8 -*-


'''Example of a spherical lens simulation

'''
from sys import exit, path
path.append("../")

from pyoptools import *
from time import time
from pylab import *

p1=[  2.62074142e-02,   8.28711584e-04,  -3.15335554e-12,  -8.74045770e-03,
   1.38564682e-11,  -8.73569248e-03 ,  7.56972857e-06  , 2.70669177e-10,
   1.03953397e-07,   2.26877290e-12 ,  4.86492588e-05 , -1.31694223e-09,
   2.24088186e-08,  -6.96709345e-12 , -9.92142646e-08  ,-8.92635998e-05,
  -3.12723744e-09 , -2.87498147e-06 , -1.11431125e-10  ,-8.80374790e-09,
  -1.71481532e-12 , -1.17248022e-04  , 1.45688200e-08  , 7.90232771e-08,
   7.51616918e-11 ,  3.18535941e-08 ,  1.92683784e-11  , 1.31056974e-10,
   2.80825629e-04 ,  1.01977869e-08 ,  1.39870763e-05  , 7.85040092e-10,
   1.27448281e-07 ,  5.22619298e-12 ,  5.87704536e-11  , 2.20054223e-12,
   3.18185885e-06 , -4.41747112e-08 , -7.78328257e-06  ,-3.35459768e-10,
  -2.72732502e-07 , -6.10303335e-11 , -2.30664974e-09  ,-2.47306884e-11,
  -9.61511753e-11 , -2.44327071e-04 , -9.37133592e-09  ,-1.68322234e-05,
  -1.17215117e-09 , -2.89524287e-07 , -4.05074309e-12  ,-5.52782825e-10,
  -3.13017434e-12 ,  1.07319606e-11 , -9.53698944e-13  , 1.16081805e-04,
   3.73002535e-08 ,  1.30789107e-05 ,  4.30825245e-10  , 4.82360279e-07,
   6.11540815e-11 ,  7.50655340e-09 ,  3.29078452e-11  , 2.43291648e-10,
   1.08516074e-11 ,  3.70286597e-11]
p2=[  9.99995510e-01  , 1.30787239e-05 ,  6.39392711e-09 ,  2.79380922e-05,
   2.00747822e-08 , -1.11905896e-04 , -2.92051734e-04  , 4.90851422e-08,
  -2.80659149e-05 , -9.40478559e-08 , -1.39119088e-03  , 1.19660292e-06,
  -3.07755589e-04 , -1.02136372e-06  , 2.57438897e-04  , 1.55735089e-03,
  -1.26707903e-06 ,  5.46563994e-04  , 1.05332711e-06  ,-3.65286593e-05,
   2.91298369e-07 ,  5.20959557e-03 , -3.18751002e-06  , 4.57576136e-03,
  -6.67160356e-06 , -1.27250227e-03 ,  5.55265248e-06  ,-8.41010590e-04,
  -2.99858091e-03 ,  2.81119744e-06  ,-2.08083741e-03  , 1.04628233e-06,
   1.10471905e-04 , -3.35268525e-06  , 5.66498745e-05  ,-3.17632834e-07,
  -7.36731786e-03 ,  1.74491348e-06 , -1.39714608e-02  , 1.83498451e-05,
   5.13942505e-04 ,  6.52531848e-06 ,  3.33390840e-03  ,-9.30595419e-06,
   1.09724339e-03  , 1.90181282e-03 , -1.12892267e-06  , 1.90756800e-03,
  -4.90248706e-06 ,  3.45658100e-04 ,  3.54337778e-06  ,-3.60094999e-04,
   1.87677335e-06 ,  2.89322714e-06 ,  1.23070380e-07  , 3.28730241e-03,
  -2.42830545e-08 ,  1.23965334e-02 , -8.62214052e-06  ,-5.37038029e-06,
  -1.59572558e-05 , -1.03386217e-03 ,  2.38881578e-07  ,-2.50067707e-03,
   4.84327821e-06 , -4.90338381e-04]


a=poly2d(p1)

b=poly2d(p2)

s=2048
xl=linspace(-1,1,s).astype(float64)
yl=linspace(-1,1,s).astype(float64)
x,y=meshgrid(xl,yl)

ti=time()

#j=  a.eval(x,y) 
#print "->", ti - time(); ti=time()

#j= a.eval1(x,y)
#print "->", ti - time(); ti=time()

#j= a.eval2(xl,yl)
#print "->", ti - time(); ti=time()
tm=0
for i in range(10000):
    j=a.gpu_eval(xl,yl)
    t=time()-ti ;ti=time()
    if tm<t:tm=t

    j1=a.gpu_eval1((s,s))
    t=time()-ti ;ti=time()
    if tm<t:tm=t
    print i,tm

